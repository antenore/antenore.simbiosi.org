<!-- Cookie Consent Banner -->
<div id="cookie-consent" class="cookie-consent">
    <div class="cookie-content">
        <p>This website uses cookies to ensure you get the best experience. By continuing to browse, you agree to our use of cookies.</p>
        <div class="cookie-buttons">
            <button id="cookie-accept" class="btn-accept">Accept</button>
            <a href="/privacy" class="btn-more">Privacy Policy</a>
        </div>
    </div>
</div>

<script>
    // Cookie handling functions
    function createCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/; SameSite=Lax";
    }

    function readCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    // Function to show the cookie consent banner
    function showCookieConsent() {
        const cookieConsent = document.getElementById('cookie-consent');
        if (cookieConsent) {
            cookieConsent.style.display = 'block';
        }
    }

    // Function to hide the cookie consent banner
    function hideCookieConsent() {
        const cookieConsent = document.getElementById('cookie-consent');
        if (cookieConsent) {
            cookieConsent.style.display = 'none';
        }
    }

    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        // First check if consent was previously given
        if (readCookie('cookie-consent') === 'accepted') {
            hideCookieConsent();
            enableAnalytics();
        } else {
            // If no consent yet, show the banner
            showCookieConsent();
        }

        // Handle accept button click
        const acceptButton = document.getElementById('cookie-accept');
        if (acceptButton) {
            acceptButton.addEventListener('click', function() {
                createCookie('cookie-consent', 'accepted', 365); // Cookie valid for 1 year
                hideCookieConsent();
                enableAnalytics();
            });
        }
    });

    // Function to enable Google Analytics
    function enableAnalytics() {
        // Only load analytics if the configuration exists
        if ('{{ site.analytics-google }}' !== '') {
            // Load Google Analytics
            const gtagScript = document.createElement('script');
            gtagScript.async = true;
            gtagScript.src = "https://www.googletagmanager.com/gtag/js?id={{ site.analytics-google }}";
            document.head.appendChild(gtagScript);

            // Initialize Google Analytics
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', '{{ site.analytics-google }}');
        }
    }
</script>
