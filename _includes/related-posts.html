<!-- Related posts section -->
{% if site.related_posts_enabled %}
<div class="related-posts">
    <h3>You might also enjoy</h3>
    <ul class="related-posts-list">
        {% assign maxRelated = 4 %}
        {% assign minCommonTags = 1 %}
        {% assign maxRelatedCounter = 0 %}
        
        {% for post in site.posts %}
            {% assign sameTagCount = 0 %}
            {% assign commonTags = '' %}
            
            {% for tag in post.tags %}
                {% if post.url != page.url %}
                    {% if page.tags contains tag %}
                        {% assign sameTagCount = sameTagCount | plus: 1 %}
                        {% capture tagmarkup %} <span class="related-tag">{{ tag }}</span> {% endcapture %}
                        {% assign commonTags = commonTags | append: tagmarkup %}
                    {% endif %}
                {% endif %}
            {% endfor %}
            
            {% if sameTagCount >= minCommonTags and maxRelatedCounter < maxRelated %}
                <li>
                    <a href="{{ site.baseurl }}{{ post.url }}">
                        {{ post.title }}
                        <small>{{ post.date | date: "%B %d, %Y" }}</small>
                    </a>
                    <div class="related-tags">Related tags: {{ commonTags }}</div>
                </li>
                {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
            {% endif %}
        {% endfor %}
        
        {% if maxRelatedCounter == 0 %}
            <p>No related posts found. Check out the <a href="{{ site.baseurl }}/blog">archive</a> instead.</p>
        {% endif %}
    </ul>
</div>
{% endif %}
